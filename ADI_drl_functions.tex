
\subsection{ADI observing mode}\label{sec:drl_functions_adi}

%---------------------------------------------------------------------

%lm_adi_cgrph_centroid

\subsubsection{Detect centroid in LM images}\label{drl:lm_adi_cgrph_centroid}
\begin{recipedef}
Name: & \hyperref[drl:lm_adi_cgrph_centroid]{\DRL{lm_adi_cgrph_centroid}} \\
Purpose: & Detect the centroid in a sequence of LM band CVC/RAVC/CLC coronographic images\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis_det_adi_cgrph}}\\
%Working remarks: & None \\
%Function Parameters: & None \\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
%Other inputs: & None \\
QC outputs: & QC LM CGRPH FWHM NN TBD\\
%Output FITS files: & None \\
Outputs: & \hyperref[dataitem:lm_cgrph_centroid_tab]{\PROD{lm_cgrph_CENTROID_TAB}}\\
                & \texttt{cpl\_error\_code} \\
General description: & Centroiding of source in LM band coronagraphic images \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging}  \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}

%n_adi_cgrph_centroid

\subsubsection{Detect centroid in N images}\label{drl:n_adi_cgrph_centroid}
\begin{recipedef}
Name: & \hyperref[drl:n_adi_cgrph_centroid]{\DRL{n_adi_cgrph_centroid}} \\
Purpose: & Detect the centroids in a sequence of N band CVC/RAVC/CLC coronographic images\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis_det_adi_cgrph}}\\
%Working remarks: & None \\
%Function Parameters: & None \\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
%Other inputs: & None \\
QC outputs: & QC N CGRPH FWHM NN TBD\\
%Output FITS files: & None \\
Outputs: & \hyperref[dataitem:n_cgrph_centroid_tab]{\PROD{n_cgrph_CENTROID_TAB}}\\
                & \texttt{cpl\_error\_code} \\
General description: & Centroiding of source in N band coronagraphic images \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging}  \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%lm_adi_app_centroid

\subsubsection{Detect centroid in APP LM images}\label{drl:lm_adi_app_centroid}
\begin{recipedef}
Name: & \hyperref[drl:lm_adi_app_centroid]{\DRL{lm_adi_app_centroid}} \\
Purpose: & Detect the centroid in a sequence of LM band APP coronographic images\\
Used in recipes: & \hyperref[rec:metis_det_adi_app]{\REC{metis_det_adi_app}}\\
%Working remarks: & None \\
%Function Parameters: & None \\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
%Other inputs: & None \\
QC outputs: & QC LM APP FWHM NN TBD\\
%Output FITS files: & None \\
Outputs: & \hyperref[dataitem:lm_app_centroid_tab]{\PROD{lm_app_CENTROID_TAB}}\\
                & \texttt{cpl\_error\_code} \\
General description: & Centroiding of source in LM band APP coronagraphic images \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging}  \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}

%n_adi_app_centroid

\subsubsection{Detect centroid in APP N images}\label{drl:n_adi_app_centroid}
\begin{recipedef}
Name: & \hyperref[drl:n_adi_app_centroid]{\DRL{n_adi_app_centroid}} \\
Purpose: & Detect the centroids in a sequence of N band APP coronographic images\\
Used in recipes: & \hyperref[rec:metis_det_adi_app]{\REC{metis_det_adi_app}}\\
%Working remarks: & None \\
%Function Parameters: & None \\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
%Other inputs: & None \\
QC outputs: & QC N APP FWHM NN TBD\\
%Output FITS files: & None \\
Outputs: & \hyperref[dataitem:n_app_centroid_tab]{\PROD{n_app_CENTROID_TAB}}\\
                & \texttt{cpl\_error\_code} \\
General description: & Centroiding of source in N band APP coronagraphic images \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging}  \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%lm_adi_cgrph_psf

\subsubsection{Calculate Median PSF for APP}\label{drl:lm_adi_cgrph_psf}
\begin{recipedef}
Name: & \hyperref[drl:lm_adi_cgrph_psf]{\DRL{lm_adi_cgrph_psf}} \\
Purpose: & Calculate median PSF for sequence of ADI images\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis_det_adi_cgrph}}\\
%Working remarks: & None \\
Function Parameters: & combination method (median, mean, sigma clipped...)\\
                     & parameters for combination method\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
       &  \hyperref[dataitem:lm_cgrph_centroid_tab]{\PROD{lm_cgrph_CENTROID_TAB}}\\
%Other inputs: & None \\
QC outputs: & QC DET CGRPH SCI FWHM ??\\
%Output FITS files: & None \\
Outputs: & \hyperref[dataitem:lm_cgrph_psf_median]{\PROD{lm_cgrph_PSF_MEDIAN}}\\
                & \texttt{cpl\_error\_code} \\
General description: & Calculation of median PSF for sequence of ADI images\ \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%n_adi_cgrph_psf

\subsubsection{Calculate median PSF for ADI N band}\label{drl:n_adi_cgrph_psf}
\begin{recipedef}
Name: & \hyperref[drl:n_adi_cgrph_psf]{\DRL{n_adi_cgrph_psf}} \\
Purpose: & Calculate median PSF for sequence of ADI images\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis_det_adi_cgrph}}\\
%Working remarks: & None \\
Function Parameters: & combination method (median, mean, sigma clipped...)\\
                     & parameters for combination method\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
       &  \hyperref[dataitem:n_cgrph_centroid_tab]{\PROD{n_cgrph_CENTROID_TAB}}\\
%Other inputs: & None \\
QC outputs: & QC DET CGRPH SCI FWHM ??\\
%Output FITS files: & None \\
Outputs: & \hyperref[dataitem:n_cgrph_psf_median]{\PROD{n_cgrph_PSF_MEDIAN}}\\
                & \texttt{cpl\_error\_code} \\
General description: & Calculation of median PSF for sequence of ADI images\ \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%lm_adi_cgrph_psf

\subsubsection{Calculate median PSF for APP LM band}\label{drl:lm_adi_app_psf}
\begin{recipedef}
Name: & \hyperref[drl:lm_adi_app_psf]{\DRL{lm_adi_app_psf}} \\
Purpose: & Calculate median PSF for sequence of ADI images\\
Used in recipes: & \hyperref[rec:metis_det_adi_app]{\REC{metis_det_adi_app}}\\
%Working remarks: & None \\
Function Parameters: & combination method (median, mean, sigma clipped...)\\
                     & parameters for combination method\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
       &  \hyperref[dataitem:lm_app_centroid_tab]{\PROD{lm_app_CENTROID_TAB}}\\
%Other inputs: & None \\
QC outputs: & QC DET APP SCI FWHM ??\\
%Output FITS files: & None \\
Outputs: & \hyperref[dataitem:lm_app_psf_median]{\PROD{lm_app_PSF_MEDIAN}}\\
                & \texttt{cpl\_error\_code} \\
General description: & Calculation of median PSF for sequence of ADI images\ \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%n_adi_app_psf

\subsubsection{Calculate median PSF for APP N band}\label{drl:n_adi_app_psf}
\begin{recipedef}
Name: & \hyperref[drl:n_adi_app_psf]{\DRL{n_adi_app_psf}} \\
Purpose: & Calculate median PSF for sequence of ADI images for the APP coronograph\\
Used in recipes: & \hyperref[rec:metis_det_adi_app]{\REC{metis_det_adi_app}}\\
%Working remarks: & None \\
Function Parameters: & combination method (median, mean, sigma clipped...)\\
                     & parameters for combination method\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
       &  \hyperref[dataitem:n_app_centroid_tab]{\PROD{n_app_CENTROID_TAB}}\\
%Other inputs: & None \\
QC outputs: & QC DET APP SCI FWHM ??\\
%Output FITS files: & None \\
Outputs: & \hyperref[dataitem:n_app_psf_median]{\PROD{n_app_PSF_MEDIAN}}\\
                & \texttt{cpl\_error\_code} \\
General description: & Calculation of median PSF for sequence of ADI images  for the APP coronograph \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}

%n_adi_app_psf

\subsubsection{Merge PSFs for LM band APP image}\label{drl:lm_merge_app_adi_psf}
\begin{recipedef}
Name: & \hyperref[drl:lm_merge_app_adi_psf]{\DRL{lm_merge_app_psf}} \\
Purpose: & Merge the components of the PSF for an LM band APP coronagraph image\\
Used in recipes: & \hyperref[rec:metis_det_adi_app]{\REC{metis_det_adi_app}}\\
%Working remarks: & None \\
Function Parameters: & combination method (median, mean, sigma clipped...)\\
                     & parameters for combination method\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
%Other inputs: & None \\
QC outputs: & \TBD\\
%Output FITS files: & None \\
Outputs: & \texttt{cpl\_error\_code} \\
General description: & Merge the components of the PSF for an LM band APP coronagraph image \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


\subsubsection{Merge PSFs for N band APP image}\label{drl:n_merge_app_adi_psf}
\begin{recipedef}
Name: & \hyperref[drl:n_merge_app_adi_psf]{\DRL{n_merge_app_psf}} \\
Purpose: & Merge the components of the PSF for an N band APP coronagraph image\\
Used in recipes: & \hyperref[rec:metis_det_adi_app]{\REC{metis_det_adi_app}}\\
%Working remarks: & None \\
Function Parameters: & combination method (median, mean, sigma clipped...)\\
                     & parameters for combination method\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
%Other inputs: & None \\
QC outputs: & \TBD\\
%Output FITS files: & None \\
Outputs: & \texttt{cpl\_error\_code} \\
General description: & Merge the components of the PSF for an N band APP coronagraph image \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}

%apply distortion correcton and regrid

\subsubsection{Apply distortion correction}\label{drl:adi_regrid}
\begin{recipedef}
Name: & \hyperref[drl:adi_regrid]{\DRL{adi_regrid}} \\
Purpose: & Apply distortion correction and regrid to align images\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis_det_adi_cgrph}}\\
%Working remarks: & None \\
Function Parameters: & Resampling method\\
                     & parameters for resampling method\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
       & \hyperref[dataitem:det_cgrph_centroid_tab]{\PROD{det_cgrph_CENTROID_TAB}}\\
       & \hyperref[dataitem:det_distortion_table]{\PROD{det_DISTORTION_TABLE}}\\
%Other inputs: & Parameters for regridding \\
QC outputs: & None\\
Output FITS files: & \hyperref[dataitem:det_cgrph_sci_centred]{\PROD{det_cgrph_SCI_CENTRED}} \\
Outputs: &   \texttt{cpl\_error\_code} \\
General description: & Apply the distortion correction and align images on a subpixel scale \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%apply distortion correcton and regrid

\subsubsection{Regrid IFU image}\label{drl:ifu_adi_regrid}
\begin{recipedef}
Name: & \hyperref[drl:ifu_adi_regrid]{\DRL{ifu_adi_regrid}} \\
Purpose: & Apply distortion correction, perform square pixel reconstruction, and regrid to align images\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis_det_adi_cgrph}}\\
%Working remarks: & None \\
Function Parameters: & Resampling method\\
                     & parameters for resampling method\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
       & \hyperref[dataitem:det_cgrph_centroid_tab]{\PROD{det_cgrph_CENTROID_TAB}}\\
       & \hyperref[dataitem:det_distortion_table]{\PROD{det_DISTORTION_TABLE}}]]\\
%Other inputs: & Parameters for regridding \\
QC outputs: & None\\
Output FITS files: & \hyperref[dataitem:det_cgrph_sci_centred]{\PROD{det_cgrph_SCI_CENTRED}} \\
Outputs: &   \texttt{cpl\_error\_code} \\
General description: & Apply the distortion correction, perform square pixel reconstruction, and align images on a subpixel scale \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%derotate images

\subsubsection{Derotate ADI images}\label{drl:adi_derotate}
\begin{recipedef}
Name: & \hyperref[drl:adi_derotate]{\DRL{adi_derotate}} \\
Purpose: & Apply disotrtion correction and Derotate a squence of coronagraphic images\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis_det_adi_cgrph}}\\
%Working remarks: & None \\
Function Parameters: method for resampling\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
%Other inputs: & None \\
QC outputs: &  QC DET CGRPH SCI SNR MEAN \\
            &  QC DET CGRPH SCI SNR PEAK \\
Output FITS files: & \hyperref[dataitem:det_cgrph_sci_derotated_psfsub]{\PROD{det_cgrph_SCI_DEROTATED_PSFSUB}} \\
                   & \hyperref[dataitem:det_cgrph_sci_derotated]{\PROD{det_cgrph_SCI_DEROTATED}} \\
%Outputs: & \hyperref[dataitem:det_cgrph_psf_median]{\PROD{det_cgrph_PSF_MEDIAN}}\\
%                & \texttt{cpl\_error\_code} \\
General description: & derotate a sequence of ADI images \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}

%calculate lm contrast curve 

\subsubsection{Calculate contrast curve for LM band}\label{drl:lm_adi_cgrph_contrast}
\begin{recipedef}
Name: & \hyperref[drl:lm_adi_cgrph_contrast]{\DRL{lm_adi_cgrph_contrast}} \\
Purpose: & Calculate contrast curves for a sequence of LM band coronagraphic images, for the RAVC/CDC/CLC coronagraph\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis_det_adi_cgrph}}\\
%Working remarks: & None \\
Function Parameters: \TBD \\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
Other inputs: & Off-axis PSF reference \\
QC outputs: & QC DET CGRPH SCI CONTRAST RAW LAMD\\
            & QC DET CGRPH SCI CONTRAST ADI LAMD\\
  Output FITS files: & \hyperref[dataitem:det_cgrph_sci_contrast_raw]{\PROD{det_cgrph_SCI_CONTRAST_RAW}} \\
                     & \hyperref[dataitem:det_cgrph_sci_contrast_adi]{\PROD{det_cgrph_SCI_CONTRAST_ADI}} \\
                     & \hyperref[dataitem:det_cgrph_sci_throughput]{\PROD{det_cgrph_SCI_THROUGHPUT}} \\
Outputs: & \texttt{cpl\_error\_code} \\
General description: &  Calculate contrast curves for a sequence of LM band coronagraphic images, for the  RAVC/CDC/CLC coronagraph\\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%calculate n contrast curve 

\subsubsection{Calculate contrast curve for N band}\label{drl:n_adi_cgrph_contrast}
\begin{recipedef}
Name: & \hyperref[drl:n_adi_cgrph_contrast]{\DRL{n_adi_cgrph_contrast}} \\
Purpose: & Calculate contrast curves for a sequence of N band coronagraphic images, for the RAVC/CDC/CLC coronagraph\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis_det_adi_cgrph}}\\
%Working remarks: & None \\
Function Parameters: \TBD \\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
Other inputs: & Off-axis PSF reference \\
QC outputs: & QC DET CGRPH SCI CONTRAST RAW LAMD\\
            & QC DET CGRPH SCI CONTRAST ADI LAMD\\
  Output FITS files: & \hyperref[dataitem:det_cgrph_sci_contrast_raw]{\PROD{det_cgrph_SCI_CONTRAST_RAW}} \\
                     & \hyperref[dataitem:det_cgrph_sci_contrast_adi]{\PROD{det_cgrph_SCI_CONTRAST_ADI}} \\
                     & \hyperref[dataitem:det_cgrph_sci_throughput]{\PROD{det_cgrph_SCI_THROUGHPUT}} \\
Outputs: & \texttt{cpl\_error\_code} \\
General description: &  Calculate contrast curves for a sequence of N band coronagraphic images, for the  RAVC/CDC/CLC coronagraph\\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%calculate lm contrast curve 

\subsubsection{Calculate contrast curve for APP LM band}\label{drl:lm_adi_app_contrast}
\begin{recipedef}
Name: & \hyperref[drl:lm_adi_app_contrast]{\DRL{lm_adi_app_contrast}} \\
Purpose: & Calculate contrast curves for a sequence of LM band coronagraphic images, for the APP coronagraph\\
Used in recipes: & \hyperref[rec:metis_det_adi_app]{\REC{metis_det_adi_app}}\\
%Working remarks: & None \\
Function Parameters: \TBD \\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
Other inputs: & Off-axis PSF reference \\
QC outputs: & QC DET APP SCI CONTRAST RAW LAMD\\
            & QC DET APP SCI CONTRAST ADI LAMD\\
  Output FITS files: & \hyperref[dataitem:det_app_sci_contrast_raw]{\PROD{det_app_SCI_CONTRAST_RAW}} \\
                     & \hyperref[dataitem:det_app_sci_contrast_adi]{\PROD{det_app_SCI_CONTRAST_ADI}} \\
                     & \hyperref[dataitem:det_app_sci_throughput]{\PROD{det_app_SCI_THROUGHPUT}} \\
Outputs: & \texttt{cpl\_error\_code} \\
General description: &  Calculate contrast curves for a sequence of LM band coronagraphic images, for the  APP coronagraph\\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%calculate n contrast curve 

\subsubsection{Calculate contrast curve for N APP images}\label{drl:n_adi_app_contrast}
\begin{recipedef}
Name: & \hyperref[drl:n_adi_app_contrast]{\DRL{n_adi_app_contrast}} \\
Purpose: & Calculate contrast curves for a sequence of N band coronagraphic images, for the APP coronagraph\\
Used in recipes: & \hyperref[rec:metis_det_adi_app]{\REC{metis_det_adi_app}}\\
%Working remarks: & None \\
Function Parameters: \TBD \\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
Other inputs: & Off-axis PSF reference \\
QC outputs: & QC DET APP SCI CONTRAST RAW LAMD\\
            & QC DET APP SCI CONTRAST ADI LAMD\\
  Output FITS files: & \hyperref[dataitem:det_app_sci_contrast_raw]{\PROD{det_APP_SCI_CONTRAST_RAW}} \\
                     & \hyperref[dataitem:det_app_sci_contrast_adi]{\PROD{det_APP_SCI_CONTRAST_ADI}} \\
                     & \hyperref[dataitem:det_app_sci_throughput]{\PROD{det_APP_SCI_THROUGHPUT}} \\
Outputs: & \texttt{cpl\_error\_code} \\
General description: &  Calculate contrast curves for a sequence of N band coronagraphic images, for the  APP coronagraph\\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}

