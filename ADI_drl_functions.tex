
\subsection{ADI observing mode}\label{sec:drl_functions_adi}

%---------------------------------------------------------------------

%lm_adi_cgrph_centroid

\subsubsection{\DRL{lm\_adi\_cgrph\_centroid}}\label{drl:lm_adi_cgrph_centroid}
\begin{recipedef}
Name: & \hyperref[drl:lm_adi_cgrph_centroid]{\DRL{lm\_adi\_cgrph\_centroid}} \\
Purpose: & Detect the centroid in a sequence of LM band CVC/RAVC/CLC coronographic images\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis\_det\_adi\_cgrph}}\\
%Working remarks: & None \\
%Function Parameters: & None \\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
%Other inputs: & None \\
QC outputs: & QC LM CGRPH FWHM NN TBD\\
%Output FITS files: & None \\
Outputs: & \PROD{lm\_cgrph\_CENTROID\_TAB}\\
                & \texttt{cpl\_error\_code} \\
General description: & Centroiding of source in LM band coronagraphic images \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging}  \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}

%n_adi_cgrph_centroid

\subsubsection{\DRL{n\_adi\_cgrph\_centroid}}\label{drl:n_adi_cgrph_centroid}
\begin{recipedef}
Name: & \hyperref[drl:n_adi_cgrph_centroid]{\DRL{n\_adi\_cgrph\_centroid}} \\
Purpose: & Detect the centroids in a sequence of N band CVC/RAVC/CLC coronographic images\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis\_det\_adi\_cgrph}}\\
%Working remarks: & None \\
%Function Parameters: & None \\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
%Other inputs: & None \\
QC outputs: & QC N CGRPH FWHM NN TBD\\
%Output FITS files: & None \\
Outputs: & \PROD{n\_cgrph\_CENTROID\_TAB}\\
                & \texttt{cpl\_error\_code} \\
General description: & Centroiding of source in N band coronagraphic images \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging}  \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%lm_adi_app_centroid

\subsubsection{\DRL{lm\_adi\_app\_centroid}}\label{drl:lm_adi_app_centroid}
\begin{recipedef}
Name: & \hyperref[drl:lm_adi_app_centroid]{\DRL{lm\_adi\_app\_centroid}} \\
Purpose: & Detect the centroid in a sequence of LM band APP coronographic images\\
Used in recipes: & \hyperref[rec:metis_det_adi_app]{\REC{metis\_det\_adi\_app}}\\
%Working remarks: & None \\
%Function Parameters: & None \\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
%Other inputs: & None \\
QC outputs: & QC LM APP FWHM NN TBD\\
%Output FITS files: & None \\
Outputs: & \PROD{lm\_app\_CENTROID\_TAB}\\
                & \texttt{cpl\_error\_code} \\
General description: & Centroiding of source in LM band APP coronagraphic images \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging}  \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}

%n_adi_app_centroid

\subsubsection{\DRL{n\_adi\_app\_centroid}}\label{drl:n_adi_app_centroid}
\begin{recipedef}
Name: & \hyperref[drl:n_adi_app_centroid]{\DRL{n\_adi\_app\_centroid}} \\
Purpose: & Detect the centroids in a sequence of N band APP coronographic images\\
Used in recipes: & \hyperref[rec:metis_det_adi_app]{\REC{metis\_det\_adi\_app}}\\
%Working remarks: & None \\
%Function Parameters: & None \\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
%Other inputs: & None \\
QC outputs: & QC N APP FWHM NN TBD\\
%Output FITS files: & None \\
Outputs: & \PROD{n\_app\_CENTROID\_TAB}\\
                & \texttt{cpl\_error\_code} \\
General description: & Centroiding of source in N band APP coronagraphic images \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging}  \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%lm_adi_cgrph_psf

\subsubsection{\DRL{lm\_adi\_cgrph\_psf}}\label{drl:lm_adi_cgrph_psf}
\begin{recipedef}
Name: & \hyperref[drl:lm_adi_cgrph_psf]{\DRL{lm_adi\_cgrph\_psf}} \\
Purpose: & Calculate median PSF for sequence of ADI images\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis\_det\_adi\_cgrph}}\\
%Working remarks: & None \\
Function Parameters: & combination method (median, mean, sigma clipped...)\\
                     & parameters for combination method\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
       &  \PROD{lm\_cgrph\_CENTROID\_TAB}\\
%Other inputs: & None \\
QC outputs: & QC DET CGRPH SCI FWHM ??\\
%Output FITS files: & None \\
Outputs: & \PROD{lm\_cgrph\_PSF\_MEDIAN}\\
                & \texttt{cpl\_error\_code} \\
General description: & Calculation of median PSF for sequence of ADI images\ \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%n_adi_cgrph_psf

\subsubsection{\DRL{n\_adi\_cgrph\_psf}}\label{drl:n_adi_cgrph_psf}
\begin{recipedef}
Name: & \hyperref[drl:n_adi_cgrph_psf]{\DRL{n_adi\_cgrph\_psf}} \\
Purpose: & Calculate median PSF for sequence of ADI images\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis\_det\_adi\_cgrph}}\\
%Working remarks: & None \\
Function Parameters: & combination method (median, mean, sigma clipped...)\\
                     & parameters for combination method\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
       &  \PROD{n\_cgrph\_CENTROID\_TAB}\\
%Other inputs: & None \\
QC outputs: & QC DET CGRPH SCI FWHM ??\\
%Output FITS files: & None \\
Outputs: & \PROD{n\_cgrph\_PSF\_MEDIAN}\\
                & \texttt{cpl\_error\_code} \\
General description: & Calculation of median PSF for sequence of ADI images\ \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%lm_adi_cgrph_psf

\subsubsection{\DRL{lm\_adi\_app\_psf}}\label{drl:lm_adi_app_psf}
\begin{recipedef}
Name: & \hyperref[drl:lm_adi_app_psf]{\DRL{lm_adi\_app\_psf}} \\
Purpose: & Calculate median PSF for sequence of ADI images\\
Used in recipes: & \hyperref[rec:metis_det_adi_app]{\REC{metis\_det\_adi\_app}}\\
%Working remarks: & None \\
Function Parameters: & combination method (median, mean, sigma clipped...)\\
                     & parameters for combination method\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
       &  \PROD{lm\_app\_CENTROID\_TAB}\\
%Other inputs: & None \\
QC outputs: & QC DET APP SCI FWHM ??\\
%Output FITS files: & None \\
Outputs: & \PROD{lm\_app\_PSF\_MEDIAN}\\
                & \texttt{cpl\_error\_code} \\
General description: & Calculation of median PSF for sequence of ADI images\ \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%n_adi_app_psf

\subsubsection{\DRL{n\_adi\_app\_psf}}\label{drl:n_adi_app_psf}
\begin{recipedef}
Name: & \hyperref[drl:n_adi_app_psf]{\DRL{n_adi\_app\_psf}} \\
Purpose: & Calculate median PSF for sequence of ADI images for the APP coronograph\\
Used in recipes: & \hyperref[rec:metis_det_adi_app]{\REC{metis\_det\_adi\_app}}\\
%Working remarks: & None \\
Function Parameters: & combination method (median, mean, sigma clipped...)\\
                     & parameters for combination method\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
       &  \PROD{n\_app\_CENTROID\_TAB}\\
%Other inputs: & None \\
QC outputs: & QC DET APP SCI FWHM ??\\
%Output FITS files: & None \\
Outputs: & \PROD{n\_app\_PSF\_MEDIAN}\\
                & \texttt{cpl\_error\_code} \\
General description: & Calculation of median PSF for sequence of ADI images  for the APP coronograph \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}

%n_adi_app_psf

\subsubsection{\DRL{lm\_merge\_app\_psf}}\label{drl:lm_merge_app_adi_psf}
\begin{recipedef}
Name: & \hyperref[drl:lm_merge_app_adi_psf]{\DRL{lm\_merge\_app\_psf}} \\
Purpose: & Merge the components of the PSF for an LM band APP coronagraph image\\
Used in recipes: & \hyperref[rec:metis_det_adi_app]{\REC{metis\_det\_adi\_app}}\\
%Working remarks: & None \\
Function Parameters: & combination method (median, mean, sigma clipped...)\\
                     & parameters for combination method\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
%Other inputs: & None \\
QC outputs: & \TBD\\
%Output FITS files: & None \\
Outputs: & \texttt{cpl\_error\_code} \\
General description: & Merge the components of the PSF for an LM band APP coronagraph image \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


\subsubsection{\DRL{n\_merge\_app\_psf}}\label{drl:n_merge_app_adi_psf}
\begin{recipedef}
Name: & \hyperref[drl:n_merge_app_adi_psf]{\DRL{n\_merge\_app\_psf}} \\
Purpose: & Merge the components of the PSF for an N band APP coronagraph image\\
Used in recipes: & \hyperref[rec:metis_det_adi_app]{\REC{metis\_det\_adi\_app}}\\
%Working remarks: & None \\
Function Parameters: & combination method (median, mean, sigma clipped...)\\
                     & parameters for combination method\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
%Other inputs: & None \\
QC outputs: & \TBD\\
%Output FITS files: & None \\
Outputs: & \texttt{cpl\_error\_code} \\
General description: & Merge the components of the PSF for an N band APP coronagraph image \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}

%apply distortion correcton and regrid

\subsubsection{\DRL{adi\_regrid}}\label{drl:adi_regrid}
\begin{recipedef}
Name: & \hyperref[drl:adi_regrid]{\DRL{adi\_regrid}} \\
Purpose: & Apply distortion correction and regrid to align images\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis\_det\_adi\_cgrph}}\\
%Working remarks: & None \\
Function Parameters: & Resampling method\\
                     & parameters for resampling method\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
       & \PROD{det\_cgrph\_CENTROID\_TAB}\\
       & \PROD{det\_DISTORTION\_TABLE}\\
%Other inputs: & Parameters for regridding \\
QC outputs: & None\\
Output FITS files: & \PROD{det\_cgrph\_SCI\_CENTRED} \\
Outputs: &   \texttt{cpl\_error\_code} \\
General description: & Apply the distortion correction and align images on a subpixel scale \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%apply distortion correcton and regrid

\subsubsection{\DRL{ifu_adi\_regrid}}\label{drl:ifu_adi_regrid}
\begin{recipedef}
Name: & \hyperref[drl:ifu_adi_regrid]{\DRL{ifu_adi\_regrid}} \\
Purpose: & Apply distortion correction, perform square pixel reconstruction, and regrid to align images\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis\_det\_adi\_cgrph}}\\
%Working remarks: & None \\
Function Parameters: & Resampling method\\
                     & parameters for resampling method\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
       & \PROD{det\_cgrph\_CENTROID\_TAB}\\
       & \PROD{det\_DISTORTION\_TABLE}]]\\
%Other inputs: & Parameters for regridding \\
QC outputs: & None\\
Output FITS files: & \PROD{det\_cgrph\_SCI\_CENTRED} \\
Outputs: &   \texttt{cpl\_error\_code} \\
General description: & Apply the distortion correction, perform square pixel reconstruction, and align images on a subpixel scale \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%derotate images

\subsubsection{\DRL{adi\_derotate}}\label{drl:adi_derotate}
\begin{recipedef}
Name: & \hyperref[drl:adi_derotate]{\DRL{adi\_derotate}} \\
Purpose: & Apply disotrtion correction and Derotate a squence of coronagraphic images\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis\_det\_adi\_cgrph}}\\
%Working remarks: & None \\
Function Parameters: method for resampling\\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
%Other inputs: & None \\
QC outputs: &  QC DET CGRPH SCI SNR MEAN \\
            &  QC DET CGRPH SCI SNR PEAK \\
Output FITS files: & \PROD{det\_cgrph\_SCI\_DEROTATED\_PFSUB} \\
                   & \PROD{det\_cgrph\_SCI\_DEROTATED} \\
%Outputs: & \PROD{det\_cgrph\_PSF\_MEDIAN}\\
%                & \texttt{cpl\_error\_code} \\
General description: & derotate a sequence of ADI images \\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}

%calculate lm contrast curve 

\subsubsection{\DRL{lm\_adi\_cgrph\_contrast}}\label{drl:lm_adi_contrast}
\begin{recipedef}
Name: & \hyperref[drl:lm_adi_contrast]{\DRL{lm\_adi\_contrast}} \\
Purpose: & Calculate contrast curves for a sequence of LM band coronagraphic images, for the RAVC/CDC/CLC coronagraph\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis\_det\_adi\_cgrph}}\\
%Working remarks: & None \\
Function Parameters: \TBD \\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
Other inputs: & Off-axis PSF reference \\
QC outputs: & QC DET CGRPH SCI CONTRAST RAW LAMD\\
            & QC DET CGRPH SCI CONTRAST ADI LAMD\\
  Output FITS files: & \PROD{det\_cgrph\_SCI\_CONTRAST\_RAW} \\
                     & \PROD{det\_cgrph\_SCI\_CONTRAST\_ADI} \\
                     & \PROD{det\_cgrph\_SCI\_THROUGHPUT} \\
Outputs: & \texttt{cpl\_error\_code} \\
General description: &  Calculate contrast curves for a sequence of LM band coronagraphic images, for the  RAVC/CDC/CLC coronagraph\\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%calculate n contrast curve 

\subsubsection{\DRL{n\_adi\_cgrph\_contrast}}\label{drl:n_adi_contrast}
\begin{recipedef}
Name: & \hyperref[drl:n_adi_contrast]{\DRL{n\_adi\_contrast}} \\
Purpose: & Calculate contrast curves for a sequence of N band coronagraphic images, for the RAVC/CDC/CLC coronagraph\\
Used in recipes: & \hyperref[rec:metis_det_adi_cgrph]{\REC{metis\_det\_adi\_cgrph}}\\
%Working remarks: & None \\
Function Parameters: \TBD \\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
Other inputs: & Off-axis PSF reference \\
QC outputs: & QC DET CGRPH SCI CONTRAST RAW LAMD\\
            & QC DET CGRPH SCI CONTRAST ADI LAMD\\
  Output FITS files: & \PROD{det\_cgrph\_SCI\_CONTRAST\_RAW} \\
                     & \PROD{det\_cgrph\_SCI\_CONTRAST\_ADI} \\
                     & \PROD{det\_cgrph\_SCI\_THROUGHPUT} \\
Outputs: & \texttt{cpl\_error\_code} \\
General description: &  Calculate contrast curves for a sequence of N band coronagraphic images, for the  RAVC/CDC/CLC coronagraph\\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%calculate lm contrast curve 

\subsubsection{\DRL{lm\_adi\_app\_contrast}}\label{drl:lm_adi_contrast}
\begin{recipedef}
Name: & \hyperref[drl:lm_adi_contrast]{\DRL{lm\_adi\_contrast}} \\
Purpose: & Calculate contrast curves for a sequence of LM band coronagraphic images, for the APP coronagraph\\
Used in recipes: & \hyperref[rec:metis_det_adi_app]{\REC{metis\_det\_adi\_app}}\\
%Working remarks: & None \\
Function Parameters: \TBD \\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
Other inputs: & Off-axis PSF reference \\
QC outputs: & QC DET APP SCI CONTRAST RAW LAMD\\
            & QC DET APP SCI CONTRAST ADI LAMD\\
  Output FITS files: & \PROD{det\_app\_SCI\_CONTRAST\_RAW} \\
                     & \PROD{det\_app\_SCI\_CONTRAST\_ADI} \\
                     & \PROD{det\_app\_SCI\_THROUGHPUT} \\
Outputs: & \texttt{cpl\_error\_code} \\
General description: &  Calculate contrast curves for a sequence of LM band coronagraphic images, for the  APP coronagraph\\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}


%calculate n contrast curve 

\subsubsection{\DRL{n\_adi\_app\_contrast}}\label{drl:n_adi_contrast}
\begin{recipedef}
Name: & \hyperref[drl:n_adi_contrast]{\DRL{n\_adi\_contrast}} \\
Purpose: & Calculate contrast curves for a sequence of N band coronagraphic images, for the APP coronagraph\\
Used in recipes: & \hyperref[rec:metis_det_adi_app]{\REC{metis\_det\_adi\_app}}\\
%Working remarks: & None \\
Function Parameters: \TBD \\
Input: & $n\times$ \texttt{const hdrl\_image * input} \\
Other inputs: & Off-axis PSF reference \\
QC outputs: & QC DET APP SCI CONTRAST RAW LAMD\\
            & QC DET APP SCI CONTRAST ADI LAMD\\
  Output FITS files: & \PROD{det\_APP\_SCI\_CONTRAST\_RAW} \\
                     & \PROD{det\_APP\_SCI\_CONTRAST\_ADI} \\
                     & \PROD{det\_APP\_SCI\_THROUGHPUT} \\
Outputs: & \texttt{cpl\_error\_code} \\
General description: &  Calculate contrast curves for a sequence of N band coronagraphic images, for the  APP coronagraph\\
Mathematical description: & see Section~\ref{ssec:algo_app_imaging} \TBD \\
Quality assessment: & Through QC parameters \\
Error conditions: & See \cite{DRLVT} (TBD). \\
Unit tests: & See \cite{DRLVT} (TBD). \\
\end{recipedef}

