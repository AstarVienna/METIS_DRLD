\documentclass[a4paper]{spie}  %>>> use for US letter paper
%\documentclass[a4paper]{spie}  %>>> use this instead for A4 paper
%\documentclass[nocompress]{spie}  %>>> to avoid compression of citations

\renewcommand{\baselinestretch}{1.0} % Change to 1.65 for double spacing
 
\usepackage{amsmath,amsfonts,amssymb}
\usepackage{graphicx}
\usepackage{todonotes}
\usepackage{lipsum}
\usepackage[colorlinks=true, allcolors=blue]{hyperref}

\title{Implementation plans for the data reduction pipeline for METIS at the ELT as part of a greater ELT data analysis network}

\author[a]{Kieran Leschinski}
\author[a]{Hugo Buddelmeijer}
\author[a]{Oliver Czoske}
\author[a]{Martin Balaz}
\author[a]{Fabian Haberhauer}
\author[a]{Jennifer Karr}
\author[a]{Gilles Otten}
\author[a]{Chi-Hung Yan}
\author[a]{Wolfgang Kausch}
\author[a]{Nadeen Sabha}
\author[a]{Thomas Marquart}
\author[a]{Werner Zeilinger}
\author[a]{Norbert Pryzbilla}
\author[a]{Shiang-Yu Wang}

\affil[a]{University of Vienna, T\"urkenschanztra\ss e 18, 1180 Vienna, Austria}

\authorinfo{Further author information contact Kieran Leschinski - E-mail: kieran.leschinski@univie.ac.at}

% Option to view page numbers
\pagestyle{empty} % change to \pagestyle{plain} for page numbers   
\setcounter{page}{301} % Set start page numbering at e.g. 301
 
\begin{document} 
\maketitle

\begin{abstract}


\end{abstract}

% Include a list of keywords after the abstract 
\keywords{Manuscript format, template, SPIE Proceedings, LaTeX}


\section{Introduction}
% ELT and METIS overview
ELT will be the largest optical telescope ever built, and optimaised for infrared wavelength.
It will a collecting area of almost 1000m2 with its 39m mirror 
From the outset adaptive optics were built into the operational concept, with deformable and tip-tilt mirrors part of the telescope's 5 mirror design.
At mid-infrared wavelengths this will allow for high-strehl (>90\%) observations at the diffraction limit of the telescope. 
E.g. FWHM of 20mas at 3µm and 100mas at 15µm.
These capabilities will open up countless new parameter spaces in all areas of astronomy and astrophysics

METIS will be the first-light MIR instrument at the ELT.
It will offer  an array of powerful observing modes including  integral-field and long-slit spectrographs, L-M and N-band imagers, and multiple types of coronagraphs for high-contrast imaging and spectroscopy.
<insert refs here> for a more indepth description of the instrument. 

- TLRs of the pipeline
- Role of the pipeline

\section{Environmental constraints for the pipeline}





- METIS TLR for performance dictate the level to which the METIS pipeline must process data
- Pipeline is to also support AIV activities
- Pipeline will need to be able to have functionality available at different levels through out AIV to enable testing
- AIV team will use pipeline to monitor performance of METIS during the integration phase
- ESO is expecting METIS to be on-sky for decades, pipeline must work for this length too
- ESO is rolling out new pipeline tool chains in python: EDPS, PyCPL. This affects the implementation efforts
- PIP is a very distributed team

\section{Need for integrated development and testing architecture}
- Pipeline as a single element in an integrated software ecosystem
- AIV data archive for storing AIV data and for monitoring the system integration of the METIS instrument
- AIV system integration tests monitor both functionality and performance of METIS
- Heavy use of instrument data simulator (ScopeSim) for pre-testing use cases in advance of AIV needs
- Pipeline as a way of connecting predictions (simulations) to reality


\section{Pipeline implementation plans}

\subsection{Scheduling matched to AIV plans}

\begin{table}[]
    \centering
\caption{Major METIS AIV milestones for which pipeline recipes need to be ready}
\label{tab:dev_aiv_milestones}
    \begin{tabular}{c|c|l}
    \hline
    \hline
         Date &   METIS AIV phase ID & Description\\
         \hline
         02-2025 &   AIV-010&PIP workstation setup in Leiden\\
         11-2025 &   AIV-250&Dress-rehearsal of data flow chain\\
 02-2026 & AIV-370&IFU system testing\\
 10-2026 &  AIV-490&IMG/LSS system testing\\
 12-2027 & AIV-640&Preliminary acceptance Europe (PAE)\\
 12-2028 & AIV-920&Commissioning on-sky at ELT starts\\
 \hline
 \end{tabular}
      
\end{table}

Early on it was decided that the pipeline would support  the system-level integration activities.
Practically this means the METIS pipeline should already contain the functionality needed by any system level tests that will use header or pixel data from the METIS detectors.
Table \ref{tab:dev_aiv_milestones} lists the major AIV phases when the AIV team will require the pipeline. 
Some examples of AIV tests which will require pipeline functionality are:

\begin{itemize}
    \item AIV-010, PIP workstation setup : At the beginning of the AIV activites the pipeline workstation will be installed in the AIV Hall in Leiden. A working pipeline skeleton is required to test the interfaces to other subsystems, most notably the staging area for freshly data frames from the METIS detectors. 
    \item  AIV-250, Dress-rehearsal of data flow chain : This phase foresees the integration of the IFU optics into the cryostat, excluding the detectors. This will be the first time the full data flow system - from raw detector readouts through to processed files - is tested. Functional recipes for the IFU data reduction must be ready by this stage.
    \item AIV-370, IFU system testing : The IFU module is fully mated with the detectors and the cryostat will b
\end{itemize}






\subsection{Functionality levels}

The development of each software recipe for the METIS data reduction pipeline is structured into four distinct phases: skeleton, functional, performance, and science-grade. This phased approach allows for targeted progress, ensuring that development can pause once the software meets the requirements for any upcoming Assembly, Integration, and Verification (AIV) system functional or performance tests. By structuring development in this way, team members can efficiently move between multiple software recipes, focusing their efforts where they are most needed and avoiding the inefficiencies that can arise from getting bogged down in overly detailed or premature optimizations. This strategy ensures a balanced and flexible development process, maximizing productivity and maintaining alignment with project milestones. 
  
 \begin{enumerate}
     \item \textbf{Skeleton recipes }are the initial stage in the development of each software recipe for the METIS data reduction pipeline. During this phase, the software recipes are essentially barebones structures that primarily focus on handling file input and output operations correctly. Despite their minimal functionality, these recipes adhere to the output specifications outlined in the design document and are capable of reading the necessary metadata from input files. Furthermore, the recipes are designed to reject or fail gracefully if inappropriate files are used as input, ensuring robustness and reliability from the outset. This foundational phase sets the stage for more advanced development, providing a clear framework that supports subsequent enhancements in functionality and performance.
 
     \item \textbf{Functional recipes} build upon the skeleton phase by incorporating sufficient code to fulfill the primary tasks outlined in the design document for each software recipe. In this phase, the recipes not only manage file input and output but also perform their intended functions, although they may not yet handle all edge cases. The pixel values in the output should reflect an initial, first-order correction, providing a meaningful representation of the data. Additionally, the internal structure of the recipes is designed to facilitate further development and expansion in later phases. Comprehensive documentation for each function should be available, and unit tests should utilize simulated data products to verify that the recipes perform their designated tasks correctly. This phase ensures that the core functionality is in place and ready for refinement and optimization in subsequent stages. 

     \item \textbf{Performance recipes} will have reached an advanced stage of development. They incorporate all expected functionalities and can handle various edge cases encountered during scientific operations. These recipes are designed to process raw data to meet the performance standards defined in the METIS science top-level requirements. However, testing is limited to simulated data and data collected during AIV testing runs. While this approach allows for thorough lab testing, it does not replicate all potential challenges encountered during actual observations. Nonetheless, achieving performance-level recipes represents significant progress toward readiness for deployment with the METIS instrument on the Extremely Large Telescope. 

     \item \textbf{Science-Grade recipes}: In an ideal scenario, science recipes would mirror the capabilities of performance recipes, as thorough lab testing would have accounted for all possible edge cases. However, the reality of on-sky testing during the METIS commissioning run may unveil unexpected challenges. This could necessitate upgrades or even complete redesigns of various algorithms to ensure optimal performance in real-world conditions. A recipe will only earn the classification of "science grade" once it has undergone testing with on-sky data, and the resulting reduced data products align with the scientific performance targets outlined in the METIS Top-Level Requirements (TLRs). This iterative process underscores the importance of rigorous testing and adaptation to ensure that METIS can deliver scientifically meaningful results once operational. 
 \end{enumerate}



\subsection{Integration with data simulator}





\subsection{Development tools}
- Pipeline to be fully developed in python, using EDPS and PyCPL frameworks
- Utilising Github toolchain

\subsection{Release schedule}


\section{Pipeline topology}
- Association matrices
- See DRL-D + DRL-VT, PIP-FDR success




\section{Outlook until PAE}
- Issues on the horizon
- Upcoming milestones


\appendix    %>>>> this command starts appendixes

\acknowledgments % equivalent to \section*{ACKNOWLEDGMENTS}       


% References
\bibliography{report} % bibliography data in report.bib
\bibliographystyle{spiebib} % makes bibtex use spiebib.bst

\end{document} 
