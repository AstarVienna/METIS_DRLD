\clearpage
\section{HDRL algorithms}\label{sec:hdrl_algorithms}

The METIS \ac{DRS} will make good use of \ac{HDRL} functions and data structures, not
the least by relying on its built-in error-propagation. The recipe descriptions
(Ch.~\ref{sec:pipeline_recipes}) also list the functions that will be used.

%-----------------------------------------------------------------------------------------------------------
\subsection{HDRL for IMG}\label{ssec:hdrlimg}
We will use the following \ac{HDRL} functions for the imaging pipeline:
\begin{itemize}
    \item \CODE{hdrl_bpm_3d_compute}
    \item \CODE{hdrl_bpm_fit_compute}
    \item \CODE{hdrl_catalogue_create}
    \item \CODE{hdrl_imagelist_collapse}
    \item \CODE{hdrl_imagelist_mult_scalar}
    \item \CODE{hdrl_imagelist_sub_image}
    \item \CODE{hdrl_persistence_compute}
    \item \CODE{hdrl_strehl_compute}
\end{itemize}

We do not foresee a need for new \ac{HDRL} algorithms for imaging parts of the \ac{DRS}.

% Moved to https://github.com/AstarVienna/METIS_DRLD/issues/102 for discussion
% \TODO{Is this true? Should we argue for ADI or anything else?}


%-----------------------------------------------------------------------------------------------------------
\subsection{HDRL for LSS}\label{ssec:hdrllss}
We are currently intending the usage of the following \ac{HDRL} algorithms for spectroscopy whenever applicable:
\begin{itemize}
    \item \texttt{hdrl\_spectrum1D\_resample}: Resampling of 1D spectra
    \item \texttt{hdrl\_efficiency\_compute}: For monitoring the system's health and performance we intend to use this built-in function to compute the efficiency of the \ac{LSS} spectroscopic mode.
    \item \texttt{hdrl\_response\_compute()}: This function provides a 1D response as function of the wavelength. 
    \item \texttt{hdrl\_utils\_airmass()}: To compute the airmass
\end{itemize}

Nowadays there are well developed algorithms available for spectroscopy-specific tasks, which are already in use in ESO pipelines and which can be generalized to be used in the \ac{HDRL}. This especially applies to algorithms developed by Piskunov and collaborators (\cite{pis21}, \cite{pis02}). We therefore recommend including their following algorithms into the \ac{HDRL}:
\begin{itemize}
    \item flatfield normalisation
    \item curvature determination
    \item slit decomposition
    \item wavelength calibration
    \item continuum normalisation
\end{itemize}
As some of these algorithms are already implemented in the \ac{CRIRES}+ pipeline
and are therefore already based on \ac{CPL} an inclusion into \ac{HDRL} should
be possible.

%-----------------------------------------------------------------------------------------------------------
\subsection{HDRL for IFU}
\label{ssec:hdrllms}

We will use the following HDRL functions for ADI processing:
\begin{itemize}
    \item \CODE{hdrl_imagelist_collapse}
\end{itemize}

Similar to the LSS above, the reduction of the IFU will rely on the algorithms
from the \ac{CRIRES} pipeline, as shown for the distortion correction algorithm
in Ch.~\ref{ssec:criticalwavelengthanddistortionifu} where this pipeline
directly gets applied to METIS simulations.

The METIS \ac{DRS} will benefit from the availability of these routines in ESO-CPL
form in any case, either by adapting and maintaining its own version of the
functionality, or preferably by using their integration into the HDRL.

