
\input{recipe_config}

\begin{tikzpicture}
  [x=1cm,
  y=-1cm,
  align=center,
  node distance=2cm and 3cm]
  \sffamily

  %% Grid for orientation. Comment out for final figure!
  % \draw[help lines, green](-5, 0) grid (8, 11);

  %%% Put workflow commands here:
  %% Main reduction workflow

  \pic (start) {start};

  \node (input) [below=0.75cm of start-m, input, fill=sciproductcolor]{%
    IFU\_SCI\_REDUCED
  };

  \node (step1) [below=2cm of input, redstep]{%
    Molecfit
  };

  \pic (stop) [below=2.cm of step1]{stop};

  %% Connections
  \draw (start-m) -- (input);
  \draw (input) -- (step1);
  \draw (step1) -- (stop-t);

  %% Input
  \node (params) [left=1.5cm of step1, yshift=1.cm, params]{%
    Molecfit params\\
    INS.IFU.SETUP
  };
  \draw (params.east) -- ++(1, 0) -- ++(0., 0.8) -- ++(0.5, 0);

  \node (lsfkernel) [left=1.5cm of step1, calib]{%
    IFU\_KERNEL
  };
  \draw (lsfkernel.east) -- (step1);

  \node (atmprofile) [left=1.5cm of step1, yshift=-1cm, external]{%
    ATM\_PROFILE
  };
  \draw (atmprofile.east) -- ++(1, 0) -- ++(0., -0.8) -- ++(0.5, 0);

  %% Output
  \node (connecttac) [connection] at
  ($(step1)!0.5!(stop-t)$) {};
  \node (reduced) [right=of connecttac, sciproduct, text width=4cm]{%
    IFU\_SCI\_REDUCED\_TAC
  };
  \draw (connecttac) -- (reduced);

  %% Frame around recipe
  \draw [frame] ($(input)!0.35!(step1) - (3,0)$)
  rectangle ($(step1)!0.75!(stop-t) + (2.5,0)$);
  \node [framecolor, anchor=north west] at
  ($(input)!0.35!(step1) - (3, 0)$) {%
    \textsl{metis\_ifu\_tellcorr}};

\end{tikzpicture}
